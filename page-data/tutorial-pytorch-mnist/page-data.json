{"componentChunkName":"component---src-templates-blog-post-js","path":"/tutorial-pytorch-mnist/","result":{"data":{"markdownRemark":{"html":"<p>In this post we will get acquainted with the basics of training a machine learning model using PyTorch. ML model development can be subdivided into the following stages</p>\n<ol>\n<li>Data Setup</li>\n<li>Model and Objective/Loss Specification</li>\n<li>Model Training</li>\n<li>Performance Evaluation</li>\n</ol>\n<p>In this tutorial, our goal is to quickly train a CNN (convolutional neural network) model going through all the four stages. The idea here isn’t necessarily to introduce CNN or ML, but it is to get used to doing things in PyTorch. We will use the <a href=\"http://yann.lecun.com/exdb/mnist/\">MNIST dataset</a>, which is considered to be an easy problem.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># CUSTOMARY IMPORTS</span>\n<span class=\"token keyword\">import</span> torch\n<span class=\"token keyword\">import</span> torchvision\n<span class=\"token keyword\">import</span> matplotlib<span class=\"token punctuation\">.</span>pyplot <span class=\"token keyword\">as</span> plt\n<span class=\"token keyword\">import</span> numpy <span class=\"token keyword\">as</span> np\n<span class=\"token keyword\">import</span> torch<span class=\"token punctuation\">.</span>nn <span class=\"token keyword\">as</span> nn\n<span class=\"token keyword\">import</span> torch<span class=\"token punctuation\">.</span>nn<span class=\"token punctuation\">.</span>functional <span class=\"token keyword\">as</span> F\n<span class=\"token keyword\">import</span> torch<span class=\"token punctuation\">.</span>optim <span class=\"token keyword\">as</span> optim\n\n<span class=\"token operator\">%</span>matplotlib inline</code></pre></div>\n<h2>Data Setup</h2>\n<p>In PyTorch we have a few concepts that can help ease the data setup process</p>\n<ol>\n<li><strong>Dataset</strong>: each dataset (like MNIST) will have a class which implements __getitem__() which returns an example (tuple)</li>\n<li><strong>DataLoader</strong>: takes a Dataset as input and outputs a generator or iterable object. One can use next() on a DataLoader object to get the next example from the dataset. The DataLoader can be setup to return a batch_size number of examples.</li>\n<li><strong>Transforms.Compose</strong>: applies a list of transforms from left to right on each example(s) that is returned</li>\n</ol>\n<p>Transforms can be used to augment the dataset by applying transformations such as scaling, rotations, masking, etc. For MNIST, the torchvision package has already implemented a Dataset called MNIST, where it will download the data for us automatically, if not already downloaded. Since the MNIST data is split up into different files, we also need to specify whether we wish to setup a train set DataLoader or a test set DataLoader.</p>\n<p>Prior to data setup, let us also define some training hyperparameters. These are not parameters in the classical sense, but they do impact the solution that we end up at. Please read the comments for more details on what they do.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># TRAINING HYPERPARAMETERS:</span>\nn_epochs <span class=\"token operator\">=</span> <span class=\"token number\">3</span>           <span class=\"token comment\"># How many passes through the training data</span>\nbatch_size_train <span class=\"token operator\">=</span> <span class=\"token number\">64</span>  <span class=\"token comment\"># Training batch size usually in [1,256]</span>\nbatch_size_test <span class=\"token operator\">=</span> <span class=\"token number\">1000</span> <span class=\"token comment\"># Test batch size (choose anything)</span>\nlearning_rate <span class=\"token operator\">=</span> <span class=\"token number\">0.01</span>   <span class=\"token comment\"># Learning rate for optimizer like SGD usually in [0.001, 0.1]</span>\nlog_frequency <span class=\"token operator\">=</span> <span class=\"token number\">100</span>\nrandom_seed <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\ntorch<span class=\"token punctuation\">.</span>manual_seed<span class=\"token punctuation\">(</span>random_seed<span class=\"token punctuation\">)</span>\ndevice <span class=\"token operator\">=</span> torch<span class=\"token punctuation\">.</span>device<span class=\"token punctuation\">(</span><span class=\"token string\">\"cuda:0\"</span> <span class=\"token keyword\">if</span> torch<span class=\"token punctuation\">.</span>cuda<span class=\"token punctuation\">.</span>is_available<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">else</span> <span class=\"token string\">\"cpu\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">train_loader <span class=\"token operator\">=</span> torch<span class=\"token punctuation\">.</span>utils<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>DataLoader<span class=\"token punctuation\">(</span>\n  torchvision<span class=\"token punctuation\">.</span>datasets<span class=\"token punctuation\">.</span>MNIST<span class=\"token punctuation\">(</span><span class=\"token string\">'./files/'</span><span class=\"token punctuation\">,</span> train<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> download<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span>\n                             transform<span class=\"token operator\">=</span>torchvision<span class=\"token punctuation\">.</span>transforms<span class=\"token punctuation\">.</span>Compose<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n                               torchvision<span class=\"token punctuation\">.</span>transforms<span class=\"token punctuation\">.</span>ToTensor<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                               torchvision<span class=\"token punctuation\">.</span>transforms<span class=\"token punctuation\">.</span>Normalize<span class=\"token punctuation\">(</span>\n                                 <span class=\"token punctuation\">(</span><span class=\"token number\">0.1307</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0.3081</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                             <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  batch_size<span class=\"token operator\">=</span>batch_size_train<span class=\"token punctuation\">,</span> shuffle<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n\ntest_loader <span class=\"token operator\">=</span> torch<span class=\"token punctuation\">.</span>utils<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>DataLoader<span class=\"token punctuation\">(</span>\n  torchvision<span class=\"token punctuation\">.</span>datasets<span class=\"token punctuation\">.</span>MNIST<span class=\"token punctuation\">(</span><span class=\"token string\">'./files/'</span><span class=\"token punctuation\">,</span> train<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span> download<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span>\n                             transform<span class=\"token operator\">=</span>torchvision<span class=\"token punctuation\">.</span>transforms<span class=\"token punctuation\">.</span>Compose<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n                               torchvision<span class=\"token punctuation\">.</span>transforms<span class=\"token punctuation\">.</span>ToTensor<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                               torchvision<span class=\"token punctuation\">.</span>transforms<span class=\"token punctuation\">.</span>Normalize<span class=\"token punctuation\">(</span>\n                                 <span class=\"token punctuation\">(</span><span class=\"token number\">0.1307</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0.3081</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                             <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  batch_size<span class=\"token operator\">=</span>batch_size_test<span class=\"token punctuation\">,</span> shuffle<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># The enumerate() method adds a counter to an iterable and returns an enumerate object</span>\nexamples <span class=\"token operator\">=</span> <span class=\"token builtin\">enumerate</span><span class=\"token punctuation\">(</span>test_loader<span class=\"token punctuation\">)</span>\nbatch_idx<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>example_X<span class=\"token punctuation\">,</span> example_y<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token builtin\">next</span><span class=\"token punctuation\">(</span>examples<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># VISUALIZE SOME EXAMPLES</span>\nfig<span class=\"token operator\">=</span>plt<span class=\"token punctuation\">.</span>figure<span class=\"token punctuation\">(</span>figsize<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> dpi<span class=\"token operator\">=</span><span class=\"token number\">60</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">9</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  plt<span class=\"token punctuation\">.</span>subplot<span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span>i<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n  plt<span class=\"token punctuation\">.</span>tight_layout<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  plt<span class=\"token punctuation\">.</span>imshow<span class=\"token punctuation\">(</span>example_X<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> cmap<span class=\"token operator\">=</span><span class=\"token string\">'gray'</span><span class=\"token punctuation\">)</span>\n  plt<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">(</span><span class=\"token string\">\"Ground Truth: {}\"</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>example_y<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  plt<span class=\"token punctuation\">.</span>xticks<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  plt<span class=\"token punctuation\">.</span>yticks<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 526px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/033d08d9a8dc46080aaeb98cdf3a3f15/2d7ab/Pytorch_MNIST_5_0.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 87.83783783783784%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAk6AAAJOgHwZJJKAAADfUlEQVQ4y11U3UuTYRR/nR9TN78Fv1JRZw6VWfMDMxVEJWfaSJlbCl7oheJGqetOERGvRMhmdZF1kUFky9TSllCSf4IhBN1E9Uf42qan33k9r0iDwzl7fs/5eM7vnFdRFKXHaDT2xcfH9xoMBgf+5ylnP1N0dHQbdB/EhTu3oesgBgaBWaF6GYfNuh1iYYwgJ5BTtqOiou7yYVxcXBWfNTQ0kNVqPZV73xHYJAlfpaWlUUpKyon4Mf5I8Xq91NjYGJ6YmIg4HA4+9IlDlcViCY+OjvJZpKSkhGJjYw9hJwr+srW1lYaGhv5WVlZqCfHCgFJUVETDw8NqMBg8Tk9PZ2evONiqq6vVwcHBSF1d3fHu7i41NTUdXAi4ylXZ7XYVxYSTkpK40iXtye3t7eR0OjkYoZd+ebKd/yMY+Xw+GhgYoOzs7F/cW8ZRzTvGa2trNdxkMrH/CmNfkWW7tLR0G/YXNLhLKiiCbEFCEMY+Qx5nZmYaBefE+0i8XVhY+BH2DpKMKDExMR786YewdkLyxcEM6YTDAONI5Mbd6zrLeG4l1B3dF9hNaKv25IKCAurs7KSOjg5KSEi4Jw5XkFFrg8fjobKyMrZ/oOc6y6+Tk5M139TUVJIpeKKgL7S4uBiur6+PYDwIlfikhzaoMBMVCoUieXl57HCYn59/znJNTQ11dXWFwbQ+cgGFo/v9/qOWlhZVsmgsY8Y4oNrf3x8hInVycpKxA4xWogz2C75fXl5+NDU1FTabzWcs22w2mpmZoenpaZIs97UGms0ay21tbbS/v08VFRWM/8E8miTgBuPd3d2E0dJ9nytgKOR2u4MYlyAzhUOHPKkQ8gbC48HYe2APoI3SY96oTzk5OUH0cR32OpIMK7KrzLAbcgtySd9lyA1h0gOCeqCvIZBB8HLYui9rLuSygt3UhpoHV/bRLxXYZZ2oubmZMBaM/UYVOssb0nPt2Xgh288UlEw7Ozvq3Nzc8UVShGU1Nzf3ZGVlRce+IWCibMoqnxUXF6vLy8sR/sCgiIfaHM7Pz6tjY2OaEyrxStO1gPw1AWnnAeGkBcQ9LeDCwoLqcrnCHBAfjyUFFdDa2hrNzs7yULPTpDzpqrSAxsfHKSsri+2fGCf9yW+5HYFAgDiGsPyUgT0wvQnZkn39f5e3MzIytpBsl3cZ+nyXEWAPVW3C/iD7PvIPK948CDWFrGcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"png\"\n        title=\"png\"\n        src=\"/static/033d08d9a8dc46080aaeb98cdf3a3f15/2d7ab/Pytorch_MNIST_5_0.png\"\n        srcset=\"/static/033d08d9a8dc46080aaeb98cdf3a3f15/12f09/Pytorch_MNIST_5_0.png 148w,\n/static/033d08d9a8dc46080aaeb98cdf3a3f15/e4a3f/Pytorch_MNIST_5_0.png 295w,\n/static/033d08d9a8dc46080aaeb98cdf3a3f15/2d7ab/Pytorch_MNIST_5_0.png 526w\"\n        sizes=\"(max-width: 526px) 100vw, 526px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2>Model Specification</h2>\n<p>All PyTorch models should inherit from the nn.Module (for automatic gradients and such). Building models in PyTorch is like Lego, we take some layers or operations like Conv2d, Linear, and then compose them in a function called forward (which is required to be defined). The forward function (also called prediction) takes the input and produces a output after processing through the model. The torch.nn.functional allows applying activation functions and dropout conveniently. We use the nn.module for layers that hold parameters and use the functional API for other operations like activations, softmax, etc.</p>\n<p>One of the challenges in model specification with CNNs and Linear or Fully-Connected layers is keeping track of the image sizes as it goes through the operations. It is important to understand that the tensor passed to the model (during training or prediction) is of dimension (BatchSize, NumChannels, H, W) and when we refer to image size we are talking about (H,W). It is common to refer to channels as filters or also kernels.</p>\n<p>The input or image sizes are non-trivial functions of parameters like kernel size, stride, dilation, padding change the size of the image. The easiest approach is to use the formula provided in the <a href=\"https://pytorch.org/docs/master/generated/torch.nn.Conv2d.html\">Conv2d Documentation</a>. We will write a simple function to compute this, so that we don’t need to spend time thinking about this. This formula also applies to the max_pool2d layers.</p>\n<p>Our model is going to be simple:<br>\nX (B,1,28,28)<br>\n—> Conv2D(1,32,5) —> MaxPool2D(2) —> ReLU<br>\n—> Conv2D(32,16,3)—> MaxPool2D(2) —> ReLU<br>\n—> Linear(100) —> Dropout(0.2) —> ReLU<br>\n—> Linear(10) —> LogSoftmax</p>\n<p>where B is Batch Size, the arguments to Conv2D are input numChannels, output numChannels and kernel size.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">get_conv_size</span><span class=\"token punctuation\">(</span>in_dim<span class=\"token punctuation\">,</span> kernel_size<span class=\"token punctuation\">,</span> stride<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> padding<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> dilation<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span> <span class=\"token punctuation\">(</span>in_dim <span class=\"token operator\">+</span> <span class=\"token number\">2</span><span class=\"token operator\">*</span>padding <span class=\"token operator\">-</span> dilation <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>kernel_size <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">//</span> stride  <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">input_size <span class=\"token operator\">=</span> <span class=\"token number\">28</span>    <span class=\"token comment\"># MNIST has 28 x 28 input images</span>\nC1_kernel_size <span class=\"token operator\">=</span> <span class=\"token number\">5</span> <span class=\"token comment\"># Customary to use odd and square kernel/filter size fxf</span>\nnum_filters_conv1 <span class=\"token operator\">=</span> <span class=\"token number\">32</span>\nnum_filters_conv2 <span class=\"token operator\">=</span> <span class=\"token number\">16</span>\nC2_kernel_size <span class=\"token operator\">=</span> <span class=\"token number\">3</span> <span class=\"token comment\"># Customary to use odd and square kernel/filter size fxf</span>\nmp2d_size <span class=\"token operator\">=</span> <span class=\"token number\">2</span>      <span class=\"token comment\"># MaxPooling2d window size (= stride)</span>\nfc1_out_size <span class=\"token operator\">=</span> <span class=\"token number\">100</span>\nfc2_out_size <span class=\"token operator\">=</span> <span class=\"token number\">10</span>\n\nC1 <span class=\"token operator\">=</span> get_conv_size<span class=\"token punctuation\">(</span>input_size<span class=\"token punctuation\">,</span> C1_kernel_size<span class=\"token punctuation\">)</span>                   <span class=\"token comment\"># C1: size after conv1</span>\nMP1 <span class=\"token operator\">=</span> get_conv_size<span class=\"token punctuation\">(</span>C1<span class=\"token punctuation\">,</span> mp2d_size<span class=\"token punctuation\">,</span> stride <span class=\"token operator\">=</span> mp2d_size<span class=\"token punctuation\">)</span> <span class=\"token comment\"># MP1: size after max_pool2d</span>\nC2 <span class=\"token operator\">=</span> get_conv_size<span class=\"token punctuation\">(</span>MP1<span class=\"token punctuation\">,</span> C2_kernel_size<span class=\"token punctuation\">)</span>                          <span class=\"token comment\"># C2: size after conv2</span>\nMP2 <span class=\"token operator\">=</span> get_conv_size<span class=\"token punctuation\">(</span>C2<span class=\"token punctuation\">,</span> mp2d_size<span class=\"token punctuation\">,</span> stride <span class=\"token operator\">=</span> mp2d_size<span class=\"token punctuation\">)</span> <span class=\"token comment\"># MP2: size after max_pool2d</span>\nfc1_in_size <span class=\"token operator\">=</span> MP2<span class=\"token operator\">*</span>MP2 <span class=\"token operator\">*</span> num_filters_conv2                        <span class=\"token comment\"># pixels * num_filters</span>\n\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f'C1:</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>C1<span class=\"token punctuation\">}</span></span><span class=\"token string\"> MP1:</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>MP1<span class=\"token punctuation\">}</span></span><span class=\"token string\">   C2:</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>C2<span class=\"token punctuation\">}</span></span><span class=\"token string\"> MP2:</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>MP2<span class=\"token punctuation\">}</span></span><span class=\"token string\">    FC1_in:</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>fc1_in_size<span class=\"token punctuation\">}</span></span><span class=\"token string\">'</span></span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">C1:24 MP1:12   C2:10 MP2:5    FC1_in:400</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">model</span><span class=\"token punctuation\">(</span>nn<span class=\"token punctuation\">.</span>Module<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token builtin\">super</span><span class=\"token punctuation\">(</span>model<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>__init__<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>conv1 <span class=\"token operator\">=</span> nn<span class=\"token punctuation\">.</span>Conv2d<span class=\"token punctuation\">(</span>in_channels<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> out_channels<span class=\"token operator\">=</span>num_filters_conv1<span class=\"token punctuation\">,</span> kernel_size<span class=\"token operator\">=</span>C1_kernel_size<span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>conv2 <span class=\"token operator\">=</span> nn<span class=\"token punctuation\">.</span>Conv2d<span class=\"token punctuation\">(</span>num_filters_conv1<span class=\"token punctuation\">,</span> num_filters_conv2<span class=\"token punctuation\">,</span> C2_kernel_size<span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>fc1 <span class=\"token operator\">=</span> nn<span class=\"token punctuation\">.</span>Linear<span class=\"token punctuation\">(</span>fc1_in_size<span class=\"token punctuation\">,</span> fc1_out_size<span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>fc2 <span class=\"token operator\">=</span> nn<span class=\"token punctuation\">.</span>Linear<span class=\"token punctuation\">(</span>fc1_out_size<span class=\"token punctuation\">,</span> fc2_out_size<span class=\"token punctuation\">)</span>           <span class=\"token comment\"># number of classes/digits = 10</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">forward</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        x <span class=\"token operator\">=</span> F<span class=\"token punctuation\">.</span>relu<span class=\"token punctuation\">(</span>F<span class=\"token punctuation\">.</span>max_pool2d<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>conv1<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> mp2d_size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        x <span class=\"token operator\">=</span> F<span class=\"token punctuation\">.</span>relu<span class=\"token punctuation\">(</span>F<span class=\"token punctuation\">.</span>max_pool2d<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>conv2<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> mp2d_size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        x <span class=\"token operator\">=</span> x<span class=\"token punctuation\">.</span>view<span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> fc1_in_size<span class=\"token punctuation\">)</span>    <span class=\"token comment\"># reshape</span>\n        x <span class=\"token operator\">=</span> F<span class=\"token punctuation\">.</span>relu<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>fc1<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        x <span class=\"token operator\">=</span> F<span class=\"token punctuation\">.</span>dropout<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span>  <span class=\"token comment\"># Apply dropout only during training</span>\n        x <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>fc2<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> F<span class=\"token punctuation\">.</span>log_softmax<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> dim<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># Instantiate our model and specify loss function.</span>\n<span class=\"token comment\"># When we combine nll_loss and log_softmax we get a cross entropy loss</span>\nnnModel <span class=\"token operator\">=</span> model<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nlossFn <span class=\"token operator\">=</span> F<span class=\"token punctuation\">.</span>nll_loss\n\n<span class=\"token comment\"># Define optimization</span>\noptimizer <span class=\"token operator\">=</span> optim<span class=\"token punctuation\">.</span>SGD<span class=\"token punctuation\">(</span>nnModel<span class=\"token punctuation\">.</span>parameters<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> lr<span class=\"token operator\">=</span>learning_rate<span class=\"token punctuation\">,</span> momentum<span class=\"token operator\">=</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">#optimizer = optim.Adam(nnModel.parameters(), lr=0.003)</span>\n\nnnModel<span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">(</span>device<span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">model(\n  (conv1): Conv2d(1, 32, kernel_size=(5, 5), stride=(1, 1))\n  (conv2): Conv2d(32, 16, kernel_size=(3, 3), stride=(1, 1))\n  (fc1): Linear(in_features=400, out_features=100, bias=True)\n  (fc2): Linear(in_features=100, out_features=10, bias=True)\n)</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">train_losses <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\ntest_losses <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\ntest_accuracy <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\nTrainLen <span class=\"token operator\">=</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>train_loader<span class=\"token punctuation\">.</span>dataset<span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">train</span><span class=\"token punctuation\">(</span>epoch<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  nnModel<span class=\"token punctuation\">.</span>train<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">for</span> batch_idx<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>X_train<span class=\"token punctuation\">,</span> y_train<span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span> <span class=\"token builtin\">enumerate</span><span class=\"token punctuation\">(</span>train_loader<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># Move to device</span>\n    X_train<span class=\"token punctuation\">,</span> y_train <span class=\"token operator\">=</span> X_train<span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">(</span>device<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> y_train<span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">(</span>device<span class=\"token punctuation\">)</span>\n    <span class=\"token comment\"># Initialize gradients</span>\n    optimizer<span class=\"token punctuation\">.</span>zero_grad<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\"># Predict on current batch of data</span>\n    y_hat <span class=\"token operator\">=</span> nnModel<span class=\"token punctuation\">(</span>X_train<span class=\"token punctuation\">)</span>\n    <span class=\"token comment\"># Calculate Average Loss</span>\n    loss <span class=\"token operator\">=</span> lossFn<span class=\"token punctuation\">(</span>y_hat<span class=\"token punctuation\">,</span> y_train<span class=\"token punctuation\">)</span>\n    <span class=\"token comment\"># Calculate Gradients</span>\n    loss<span class=\"token punctuation\">.</span>backward<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\"># Update model parameters using SGC</span>\n    optimizer<span class=\"token punctuation\">.</span>step<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> batch_idx <span class=\"token operator\">%</span> log_frequency <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n      <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f'Train Epoch: </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>epoch<span class=\"token punctuation\">}</span></span><span class=\"token string\"> </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>batch_idx <span class=\"token operator\">*</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>X_train<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>TrainLen<span class=\"token punctuation\">}</span></span><span class=\"token string\"> Loss:</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>loss<span class=\"token punctuation\">.</span>item<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token string\">\\n'</span></span><span class=\"token punctuation\">)</span>\n      train_losses<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>loss<span class=\"token punctuation\">.</span>item<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  nnModel<span class=\"token punctuation\">.</span><span class=\"token builtin\">eval</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  test_loss <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n  correct <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n  <span class=\"token keyword\">with</span> torch<span class=\"token punctuation\">.</span>no_grad<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">for</span> X_test<span class=\"token punctuation\">,</span> y_test <span class=\"token keyword\">in</span> test_loader<span class=\"token punctuation\">:</span>\n      X_test<span class=\"token punctuation\">,</span> y_test <span class=\"token operator\">=</span> X_test<span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">(</span>device<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> y_test<span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">(</span>device<span class=\"token punctuation\">)</span>\n      y_hat <span class=\"token operator\">=</span> nnModel<span class=\"token punctuation\">(</span>X_test<span class=\"token punctuation\">)</span>\n      test_loss <span class=\"token operator\">+=</span> lossFn<span class=\"token punctuation\">(</span>y_hat<span class=\"token punctuation\">,</span> y_test<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>item<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      pred <span class=\"token operator\">=</span> y_hat<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span><span class=\"token builtin\">max</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> keepdim<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n      correct <span class=\"token operator\">+=</span> pred<span class=\"token punctuation\">.</span>eq<span class=\"token punctuation\">(</span>y_test<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>view_as<span class=\"token punctuation\">(</span>pred<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">sum</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  test_loss <span class=\"token operator\">/=</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>test_loader<span class=\"token punctuation\">.</span>dataset<span class=\"token punctuation\">)</span>\n  test_losses<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>test_loss<span class=\"token punctuation\">)</span>\n  accuracy <span class=\"token operator\">=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">.</span> <span class=\"token operator\">*</span> correct <span class=\"token operator\">/</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>test_loader<span class=\"token punctuation\">.</span>dataset<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f'\\nTest set: Avg. loss: </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>test_loss<span class=\"token punctuation\">:</span><span class=\"token format-spec\">.4f</span><span class=\"token punctuation\">}</span></span><span class=\"token string\">, Accuracy: </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>accuracy<span class=\"token punctuation\">}</span></span><span class=\"token string\"> %\\n'</span></span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span><span class=\"token punctuation\">(</span>accuracy<span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">test_accuracy<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>test<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> epoch <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> n_epochs <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  train<span class=\"token punctuation\">(</span>epoch<span class=\"token punctuation\">)</span>\n  test_accuracy<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>test<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Test set: Avg. loss: 0.0023, Accuracy: 8.859999656677246 %\n\nTrain Epoch: 1 0/60000 Loss:2.3057243824005127\n\nTrain Epoch: 1 6400/60000 Loss:1.1642037630081177\n\nTrain Epoch: 1 12800/60000 Loss:0.49353185296058655\n\nTrain Epoch: 1 19200/60000 Loss:0.5935971140861511\n\nTrain Epoch: 1 25600/60000 Loss:0.359576940536499\n\nTrain Epoch: 1 32000/60000 Loss:0.453757643699646\n\nTrain Epoch: 1 38400/60000 Loss:0.3063638210296631\n\nTrain Epoch: 1 44800/60000 Loss:0.3180357813835144\n\nTrain Epoch: 1 51200/60000 Loss:0.24858295917510986\n\nTrain Epoch: 1 57600/60000 Loss:0.21152184903621674\n\n\nTest set: Avg. loss: 0.0002, Accuracy: 93.44999694824219 %\n\nTrain Epoch: 2 0/60000 Loss:0.5599241852760315\n\nTrain Epoch: 2 6400/60000 Loss:0.2692301273345947\n\nTrain Epoch: 2 12800/60000 Loss:0.4145662784576416\n\nTrain Epoch: 2 19200/60000 Loss:0.30198949575424194\n\nTrain Epoch: 2 25600/60000 Loss:0.146678626537323\n\nTrain Epoch: 2 32000/60000 Loss:0.24326419830322266\n\nTrain Epoch: 2 38400/60000 Loss:0.2738964557647705\n\nTrain Epoch: 2 44800/60000 Loss:0.15883874893188477\n\nTrain Epoch: 2 51200/60000 Loss:0.11805892735719681\n\nTrain Epoch: 2 57600/60000 Loss:0.08396653831005096\n\n\nTest set: Avg. loss: 0.0001, Accuracy: 95.48999786376953 %\n\nTrain Epoch: 3 0/60000 Loss:0.16938048601150513\n\nTrain Epoch: 3 6400/60000 Loss:0.1264750063419342\n\nTrain Epoch: 3 12800/60000 Loss:0.09591894596815109\n\nTrain Epoch: 3 19200/60000 Loss:0.12127664685249329\n\nTrain Epoch: 3 25600/60000 Loss:0.07895562797784805\n\nTrain Epoch: 3 32000/60000 Loss:0.16709774732589722\n\nTrain Epoch: 3 38400/60000 Loss:0.09805037081241608\n\nTrain Epoch: 3 44800/60000 Loss:0.1537969708442688\n\nTrain Epoch: 3 51200/60000 Loss:0.11770787835121155\n\nTrain Epoch: 3 57600/60000 Loss:0.08659812062978745\n\n\nTest set: Avg. loss: 0.0001, Accuracy: 96.23999786376953 %</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">fig<span class=\"token operator\">=</span>plt<span class=\"token punctuation\">.</span>figure<span class=\"token punctuation\">(</span>figsize<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> dpi<span class=\"token operator\">=</span><span class=\"token number\">60</span><span class=\"token punctuation\">)</span>\nx <span class=\"token operator\">=</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span>log_frequency<span class=\"token operator\">*</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>train_losses<span class=\"token punctuation\">)</span><span class=\"token operator\">*</span>batch_size_train<span class=\"token punctuation\">,</span>log_frequency<span class=\"token operator\">*</span>batch_size_train<span class=\"token punctuation\">)</span>\nplt<span class=\"token punctuation\">.</span>plot<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span> train_losses<span class=\"token punctuation\">,</span> color<span class=\"token operator\">=</span><span class=\"token string\">'blue'</span><span class=\"token punctuation\">)</span>\nx <span class=\"token operator\">=</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> TrainLen<span class=\"token operator\">*</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>test_losses<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> TrainLen<span class=\"token punctuation\">)</span>\nplt<span class=\"token punctuation\">.</span>plot<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span>test_losses<span class=\"token punctuation\">,</span><span class=\"token string\">'r*'</span><span class=\"token punctuation\">)</span>\nplt<span class=\"token punctuation\">.</span>plot<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">,</span>np<span class=\"token punctuation\">.</span>array<span class=\"token punctuation\">(</span>test_accuracy<span class=\"token punctuation\">)</span><span class=\"token operator\">/</span><span class=\"token number\">100.0</span><span class=\"token punctuation\">,</span><span class=\"token string\">'g*-'</span><span class=\"token punctuation\">)</span>\nplt<span class=\"token punctuation\">.</span>legend<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'Train Loss'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Test Loss'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Accuracy Probability'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> loc<span class=\"token operator\">=</span><span class=\"token string\">'upper right'</span><span class=\"token punctuation\">)</span>\nplt<span class=\"token punctuation\">.</span>xlabel<span class=\"token punctuation\">(</span><span class=\"token string\">'number of training examples seen'</span><span class=\"token punctuation\">)</span>\nplt<span class=\"token punctuation\">.</span>ylabel<span class=\"token punctuation\">(</span><span class=\"token string\">'negative log likelihood loss'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Text(0, 0.5, &#39;negative log likelihood loss&#39;)</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 508px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/06a8b5790020805fef8b7b43c7de90d9/2fd48/Pytorch_MNIST_15_1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 79.05405405405406%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAk6AAAJOgHwZJJKAAAB9klEQVQ4y52T24oUMRCGexf0CdQL73w2wcdQPKyCbyOoeNodVFgYvFcR3QXRHmc63elDkk7lUGWSnpntWWZ1tOCnk0rl66pKkmXB8nx+q23F575Xx1KqqVJ/1hAjp5zJ6enp9+nJybfo/9A0zbvIy+paHNB/mEdLi2JBeZ5T3/dUFIVPwMVi9jAGOIdAhA4R/S6y3vloLpgxBoUQXQJ2XX0v/dGTCcBgf8/uXFCaWGtlAkrZ3d0VGBdTAJ6NVzsAYABWFTtYAu154Goy2rxNG8A9a+H20MNVhtshF6dNmxkCqDvRIeUZcBsg+jz6bdoAXuK8fBAdQqxKHmACBHXQkTRyPW50Q7zn1Op2reBDaSVp0EOG1upUslIxw6GAGBgB4IC0BTLOpGwuLHpcMuf8fnQwRkZrQmEb6m2fwrwbl0w7HUo2m/16lHqovP36o8ZFCTT0FCmfYfoOSYxF4/kmUKk+HUoDXIM1rlfk6to7zsk1bRzjWqEC5zyGl4HhmaCzFh0A2nBD0BhoE5Cx4vG/vGEctSHcXVpdCNCWEvDLp48326o6Dg/86Xw+f9t13UtWlpOaFW9E076oOD8E6J+zspgYrZ4Vs3zSifY1Y+VRWbIjIdtXRf7zPS+rJ9kWu7z87gXtB10Luh50JehG0NWlL1uu74/3/QYo0k85ur158wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"png\"\n        title=\"png\"\n        src=\"/static/06a8b5790020805fef8b7b43c7de90d9/2fd48/Pytorch_MNIST_15_1.png\"\n        srcset=\"/static/06a8b5790020805fef8b7b43c7de90d9/12f09/Pytorch_MNIST_15_1.png 148w,\n/static/06a8b5790020805fef8b7b43c7de90d9/e4a3f/Pytorch_MNIST_15_1.png 295w,\n/static/06a8b5790020805fef8b7b43c7de90d9/2fd48/Pytorch_MNIST_15_1.png 508w\"\n        sizes=\"(max-width: 508px) 100vw, 508px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">with</span> torch<span class=\"token punctuation\">.</span>no_grad<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  output <span class=\"token operator\">=</span> nnModel<span class=\"token punctuation\">(</span>example_X<span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">(</span>device<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">fig<span class=\"token operator\">=</span>plt<span class=\"token punctuation\">.</span>figure<span class=\"token punctuation\">(</span>figsize<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> dpi<span class=\"token operator\">=</span><span class=\"token number\">60</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  plt<span class=\"token punctuation\">.</span>subplot<span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span>i<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n  plt<span class=\"token punctuation\">.</span>tight_layout<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  plt<span class=\"token punctuation\">.</span>imshow<span class=\"token punctuation\">(</span>example_X<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> cmap<span class=\"token operator\">=</span><span class=\"token string\">'gray'</span><span class=\"token punctuation\">)</span>\n  plt<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">(</span><span class=\"token string\">\"Prediction: {}\"</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>\n    output<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span><span class=\"token builtin\">max</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> keepdim<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>item<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  plt<span class=\"token punctuation\">.</span>xticks<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  plt<span class=\"token punctuation\">.</span>yticks<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 540px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a3ed78e40894596a3de682ac433f8643/07484/Pytorch_MNIST_17_0.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 85.8108108108108%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAk6AAAJOgHwZJJKAAADYElEQVQ4y1VUW0hUURS9vp3xMaOOD3yPM6Y2ovkaNfE5CjrjI2cqGkQdHUqhghA/EqWk0LRM6COiDz8iCozwK0qIfpIie0pl/pgQQmBhZVgfSezWHvdIXljcfdbd99y9117nKoqimIFjgAsoUbYvHdAVHBzcjbvd399fJbwVOAp0+vr6GpnAs73CdavV6mpFr9dPp6amktFoJI1G80BetBUUFFBCQgIh3goKCkpjUqvVLpeUlBDWzA9K7pjBYKDm5mbKyMhYULDJtNPppOHhYQoICNjZ0Gq1UmtrK+HZFtaeDVHVx+rqaqqrq9u1oc1mI5fLxdwCE9ejoqI2c3JyfiK+LUm1KH+zsrJyLS0tbRXrFOGfoZv1/Px8/sgp4QZra2t/ocINxI8UlJ+N4DDQqlKp9nFGWFiYlrUDDgKWxMTEIHm5QnLtgYGByVI1V38IcPj4+BQxdzUiIuKH2Wz+hviGvFgTGxv7PSUl5bOfn98K1snCz0GKtezs7N+ITwh3Ojw8fCM9PX0d8SwT0729vTQ1NcUa3PdqGBMTQz09PRQfH//HqyGu5YmJCaqvr9+lYVZWFrGOXg1nOjo6qL+/nzwabF/NADU0NBC0ZN4g/Crn8WAQnxVuAoOliooK5pYUaFGMwA10APvFWzHsNYEdQ1MzD42ssE6X8HuYgyQm9iD7GHGNZ0pIfAU/zmOjEflqEVp+YbFYnqBC1iVO+JvAfGho6BvkHhHOjcG+hjTPEV9j4i6mSJ2dnVzyQ0lqys3NpcnJSdZwp2Vs/qmpqYnKy8uZOyO5l/gAuN1u5haZuOdwOKi0tJSJx5J0oLGxkQYGBqiqqoowbaPwX/lEwJuce164K5mZmdTS0sIcO0JxREdHj+GUjKJ1pyQZdDrdhZCQkHNJSUlDhYWFWuFPwqMjaHcccZnXYrDdOGw2KmdaaQEu8/jFtDwUPW7j+DkwNwBoZCjHuUXgIgZQLLmVPGnhuj0tw5TU1tbGrc15W+afRXt7O2FY3IqnZZykL3y++dn/LbNcLJun5bi4uDv8ot1uJ/w1Zr3Gxvn0+BCm/es1Nipc4eGJiYckd9xkMlFfXx+h2recNApRP0RGRr7nr0lSGXRZzMvLewmfPsU6QfgZaL0AXZf5fyk+ZBmWYLN3MPitf5LPAt2MTgFKAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"png\"\n        title=\"png\"\n        src=\"/static/a3ed78e40894596a3de682ac433f8643/07484/Pytorch_MNIST_17_0.png\"\n        srcset=\"/static/a3ed78e40894596a3de682ac433f8643/12f09/Pytorch_MNIST_17_0.png 148w,\n/static/a3ed78e40894596a3de682ac433f8643/e4a3f/Pytorch_MNIST_17_0.png 295w,\n/static/a3ed78e40894596a3de682ac433f8643/07484/Pytorch_MNIST_17_0.png 540w\"\n        sizes=\"(max-width: 540px) 100vw, 540px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>","excerpt":"In this post we will get acquainted with the basics of training a machine learning model using PyTorch. ML model development can be subdivided into the…","frontmatter":{"title":"Tutorial on recognizing digits in PyTorch","date":"2020-07-23T00:00:00.000Z","subject":["ml","tutorial","pytorch","mnist","cnn"],"author":"RSP","featimg":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAk6AAAJOgHwZJJKAAADOklEQVQ4y01U7UtTcRS+vr/Mt033ZX1oL0lrKsxNUpb6yYFu6kyEajI3t7YyEQUtaJVf+iA5TBesIoiwbQlBQoT+V718ic079fSc67nShYfzu7/n/s495zzPvYqiKG4g0tjYGKurq4tgHaqqqjIjKjU1NVcQ7gAxYKG+vv4e4g3mqqurmxACwjHuavfNzc1fsSDgnCOS8XpKubgWa2traXJyktra2jQeiXaFs+PZv3a7nVpbW0lykGKz2b6srq5SIBBQt7a2zgYHB5kIyqFoMBgkv99/iupVt9vNXEY4Gzr4E4vFCM+cGY3GcylKKZjNZorH46VcLqfKmwJyaGF8fJwrPFlfXy/l83lqb2/fZqKhocGK8BMdnCeTSXVqaqqCe1XBm39wkrm5OZLqCPO8LQkf8P3o6CjNz8/T0NAQoap3Ml+H3mY4HKa+vr6LljGHMBZvPR7PbldX1x7WO4BTEnqBNwDvvwZy/43DiLMvmbdYLHsGg4H5V0z4QTxHfAakgTXcX5VD17F+wjxmlG5qanqKPR8TULwV4SHwAuDzjyHYI+a+c6nDw8OUSqVoenqaS58Ra6SYYxXT6TQrTFIlXw52QHd3N6E7doGutFJwOp2UzWbLnZ2dFZR+KQpmucAPYX7q8fFxGVUxty0JrRDol9frpUgkUhkYGDjFHkPJIxGtra2V+CBLjzdrCeFRLeHh4eEJEZX6+/tJn5OuMnC2ubmpwg2qpjKuo5GREYIH2Yta2Ug4ywQiz4gmJiYoGo3qLb2XCq/pHwJ7UTrTWr6F/lNQKoF1Ag9EES26eTG3OOJ9QI8e4QzyWSYdDgfvLwJhroK/wy/Avslk2kf8gCQuOXQT+AR8xp4WdcFwmcRiBd6HAz6KxZQjq9VKmUyGlpeX9bJnxbxayy6XSzM2r7F32bKoTmNjYxQKhS5bzre0tFChUCglEglNFAw8IF5bkBmerKyslHiNL0tTGaOxAizK+c7Ojtrb21vRRSnCtHRwcFBeWlqqyB8lIBVqCWErFS4oS4Xaz6Gjo8OG8Nvn81GxWORzpzin2eYb/xw2NjZoZmZG/31NSxUsFGE+mtLCZcVSdoRKT08PcVJd8X9vni815kutKwAAAABJRU5ErkJggg==","aspectRatio":1.1494252873563218,"src":"/static/30f9b6ba66e77895bd0b7d2efd96bd2e/497c6/Pytorch_MNIST_5_0.png","srcSet":"/static/30f9b6ba66e77895bd0b7d2efd96bd2e/65e33/Pytorch_MNIST_5_0.png 100w,\n/static/30f9b6ba66e77895bd0b7d2efd96bd2e/69585/Pytorch_MNIST_5_0.png 200w,\n/static/30f9b6ba66e77895bd0b7d2efd96bd2e/497c6/Pytorch_MNIST_5_0.png 400w,\n/static/30f9b6ba66e77895bd0b7d2efd96bd2e/2a1ea/Pytorch_MNIST_5_0.png 526w","sizes":"(max-width: 400px) 100vw, 400px"}}}},"fields":{"slug":"/tutorial-pytorch-mnist/","readingTime":{"text":"8 min read"}}},"site":{"siteMetadata":{"title":"JumpML"}}},"pageContext":{"slug":"/tutorial-pytorch-mnist/"}}}